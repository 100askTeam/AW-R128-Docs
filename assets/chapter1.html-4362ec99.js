import{_ as p,r as e,o as c,c as o,a as n,b as s,d as i,e as a}from"./app-e85d5a28.js";const u={},l=a('<h1 id="点亮一颗-led-灯" tabindex="-1"><a class="header-anchor" href="#点亮一颗-led-灯" aria-hidden="true">#</a> 点亮一颗 LED 灯</h1><table><thead><tr><th style="text-align:left;">本文案例代码</th><th style="text-align:left;">下载地址</th></tr></thead><tbody><tr><td style="text-align:left;">点亮一颗 LED 灯案例代码</td><td style="text-align:left;">https://www.aw-ol.com/downloads?cat=24</td></tr></tbody></table><p>首先我们搭建电路，如下：</p><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/demo/part1/chapter1/image1.png" alt=""></p><table><thead><tr><th style="text-align:left;">引脚</th><th style="text-align:left;">LED</th></tr></thead><tbody><tr><td style="text-align:left;">PA18</td><td style="text-align:left;">红色 LED</td></tr><tr><td style="text-align:left;">PA13</td><td style="text-align:left;">绿色 LED</td></tr><tr><td style="text-align:left;">PA12</td><td style="text-align:left;">黄色 LED</td></tr></tbody></table>',5),d={id:"载入方案",tabindex:"-1"},r=n("a",{class:"header-anchor",href:"#载入方案","aria-hidden":"true"},"#",-1),k={href:"https://yuzukihd.top/R128Module/#/r128/hello_world?id=%E8%BD%BD%E5%85%A5%E6%96%B9%E6%A1%88",target:"_blank",rel:"noopener noreferrer"},_=a(`<p>我们使用的开发板是 R128-Devkit，需要开发 C906 核心的应用程序，所以载入方案选择<code>r128s2_module_c906</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token builtin class-name">source</span> envsetup.sh 
$ lunch_rtos <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/demo/part1/chapter1/image2.png" alt=""></p><h2 id="勾选-gpio-驱动" tabindex="-1"><a class="header-anchor" href="#勾选-gpio-驱动" aria-hidden="true">#</a> 勾选 GPIO 驱动</h2><p><code>mrtos_menuconfig</code> 找到下列驱动</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Drivers Options  ---&gt;
    soc related device drivers  ---&gt;
            GPIO devices ---&gt;
                [*] enable GPIO driver
                [*] enbale GPIO hal APIs Test command
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/demo/part1/chapter1/image3.png" alt=""></p><h2 id="编写程序" tabindex="-1"><a class="header-anchor" href="#编写程序" aria-hidden="true">#</a> 编写程序</h2><p>打开你喜欢的编辑器，修改文件：<code>lichee/rtos/projects/r128s2/module_c906/src/main.c</code></p><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/demo/part1/chapter1/image4.png" alt=""></p><h3 id="引入头文件" tabindex="-1"><a class="header-anchor" href="#引入头文件" aria-hidden="true">#</a> 引入头文件</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;hal_gpio.h&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/demo/part1/chapter1/image5.png" alt=""></p><h3 id="使用-gpio-配置引脚" tabindex="-1"><a class="header-anchor" href="#使用-gpio-配置引脚" aria-hidden="true">#</a> 使用 GPIO 配置引脚</h3><h4 id="配置-gpio-的上下拉状态" tabindex="-1"><a class="header-anchor" href="#配置-gpio-的上下拉状态" aria-hidden="true">#</a> 配置 GPIO 的上下拉状态</h4><p>使用 <code>hal_gpio_set_pull(gpio_pin_t pin, gpio_pull_status_t pull);</code> 来设置。这里我们设置 <code>PA18</code> 引脚为默认上拉状态。</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token function">hal_gpio_set_pull</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_PULL_UP<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="配置-gpio-输入输出模式" tabindex="-1"><a class="header-anchor" href="#配置-gpio-输入输出模式" aria-hidden="true">#</a> 配置 GPIO 输入输出模式</h4><p>使用 <code>hal_gpio_set_direction(gpio_pin_t pin, gpio_direction_t direction);</code> 来设置 GPIO 的输入输出模式，这里配置为输出模式。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>hal_gpio_set_direction(GPIOA(18), GPIO_DIRECTION_OUTPUT);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="配置-gpio-的-mux-功能" tabindex="-1"><a class="header-anchor" href="#配置-gpio-的-mux-功能" aria-hidden="true">#</a> 配置 GPIO 的 MUX 功能</h4><p>GPIO 通常有多种功能，需要配置 MUX 选择需要的功能，使用 <code>hal_gpio_pinmux_set_function(gpio_pin_t pin, gpio_muxsel_t function_index);</code> 来设置 GPIO 的复用功能，这里配置为GPIO 输出模式（<code>GPIO_MUXSEL_OUT</code>）</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token function">hal_gpio_pinmux_set_function</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_MUXSEL_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="配置-gpio-的电平" tabindex="-1"><a class="header-anchor" href="#配置-gpio-的电平" aria-hidden="true">#</a> 配置 GPIO 的电平</h4><p>使用 <code>hal_gpio_set_data(gpio_pin_t pin, gpio_data_t data);</code> 来配置 GPIO 的电平，这里配置 <code>PA18</code> 为高电平点亮 LED</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="完整的配置-gpio" tabindex="-1"><a class="header-anchor" href="#完整的配置-gpio" aria-hidden="true">#</a> 完整的配置 GPIO</h4><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token function">hal_gpio_set_pull</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_PULL_UP<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 配置 GPIO 的上下拉状态</span>
<span class="token function">hal_gpio_set_direction</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DIRECTION_OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 配置 GPIO 输入输出模式</span>
<span class="token function">hal_gpio_pinmux_set_function</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_MUXSEL_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 配置 GPIO 的 MUX 功能</span>
<span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 配置 GPIO 的电平</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以此类推，我们同时配置 <code>PA18</code>， <code>PA13</code>，<code>PA12</code> 的 GPIO</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token function">hal_gpio_set_pull</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_PULL_UP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hal_gpio_set_direction</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DIRECTION_OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hal_gpio_pinmux_set_function</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_MUXSEL_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">hal_gpio_set_pull</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_PULL_UP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hal_gpio_set_direction</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DIRECTION_OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hal_gpio_pinmux_set_function</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_MUXSEL_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">hal_gpio_set_pull</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_PULL_UP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hal_gpio_set_direction</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DIRECTION_OUTPUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hal_gpio_pinmux_set_function</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_MUXSEL_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/demo/part1/chapter1/image6.png" alt=""></p><h2 id="结果" tabindex="-1"><a class="header-anchor" href="#结果" aria-hidden="true">#</a> 结果</h2><p>编译固件后烧录，可以看到三色 LED 灯同时亮起。</p><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/demo/part1/chapter1/image7.png" alt=""></p><h2 id="流水灯" tabindex="-1"><a class="header-anchor" href="#流水灯" aria-hidden="true">#</a> 流水灯</h2><p>为了实现流水灯，我们先实现一个 <code>sleep</code> 函数</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">msleep</span><span class="token punctuation">(</span><span class="token keyword">int</span> ms<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">vTaskDelay</span><span class="token punctuation">(</span>ms <span class="token operator">/</span> portTICK_RATE_MS<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/demo/part1/chapter1/image8.png" alt=""></p><p>然后实现流水灯逻辑即可，之前已经设置过的GPIO状态不需要重复设置。</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">msleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">msleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hal_gpio_set_data</span><span class="token punctuation">(</span><span class="token function">GPIOA</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GPIO_DATA_HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">msleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/demo/part1/chapter1/image9.png" alt=""></p>`,41);function h(m,v){const t=e("ExternalLinkIcon");return c(),o("div",null,[l,n("h2",d,[r,s(),n("a",k,[s("载入方案"),i(t)])]),_])}const b=p(u,[["render",h],["__file","chapter1.html.vue"]]);export{b as default};

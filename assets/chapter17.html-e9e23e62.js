import{_ as n,o as s,c as a,e as p}from"./app-e85d5a28.js";const t={},e=p(`<h1 id="mbus" tabindex="-1"><a class="header-anchor" href="#mbus" aria-hidden="true">#</a> Mbus</h1><p>MSI（Memory System Interconnet）是SoC系统中统筹所有模块访问dram的总线互联器。MSI支持AXI、MBUS、MBUS和MSB接口，各种接口的数量单独可配，为各个模块提供高效的存储交互。MSI具有以下特点</p><ul><li>优先级控制</li><li>带宽监控</li><li>数据加扰</li><li>安全控制功能</li></ul><p>其中的Mbus模块提供给用户使用的包括总线使能和获取带宽接口。</p><h2 id="模块配置" tabindex="-1"><a class="header-anchor" href="#模块配置" aria-hidden="true">#</a> 模块配置</h2><p>配置路径如下:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Kernel Setup ---&gt;
    Drivers Setup ---&gt;
        SoC HAL Drivers ---&gt;
            MBUS Devices ---&gt;
                [*] enable mbus driver
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="源码结构" tabindex="-1"><a class="header-anchor" href="#源码结构" aria-hidden="true">#</a> 源码结构</h2><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code>rtos<span class="token operator">-</span>hal<span class="token operator">/</span>
<span class="token operator">|</span><span class="token operator">--</span> hal<span class="token operator">/</span>source<span class="token operator">/</span>mbus<span class="token operator">/</span>hal_mbus<span class="token punctuation">.</span>c   <span class="token comment">// hal层接口代码</span>
<span class="token operator">|</span><span class="token operator">--</span> include<span class="token operator">/</span>hal<span class="token operator">/</span>sunxi_hal_mbus<span class="token punctuation">.</span>h <span class="token comment">// 头文件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="模块接口介绍" tabindex="-1"><a class="header-anchor" href="#模块接口介绍" aria-hidden="true">#</a> 模块接口介绍</h2><h3 id="mbus-获取带宽枚举" tabindex="-1"><a class="header-anchor" href="#mbus-获取带宽枚举" aria-hidden="true">#</a> Mbus 获取带宽枚举</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token comment">/* MBUS PMU ids */</span>
<span class="token keyword">enum</span> <span class="token class-name">mbus_pmu</span> <span class="token punctuation">{</span>
    MBUS_PMU_CPU    <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token comment">/* CPU bandwidth */</span>
    MBUS_PMU_GPU<span class="token punctuation">,</span>           <span class="token comment">/* GPU bandwidth */</span>
    MBUS_PMU_VE<span class="token punctuation">,</span>            <span class="token comment">/* VE */</span>
    MBUS_PMU_DISP<span class="token punctuation">,</span>          <span class="token comment">/* DISPLAY */</span>
    MBUS_PMU_OTH<span class="token punctuation">,</span>           <span class="token comment">/* other masters */</span>
    MBUS_PMU_TOTAL<span class="token punctuation">,</span>         <span class="token comment">/* total masters */</span>
    MBUS_PMU_RV_SYS<span class="token punctuation">,</span>        <span class="token comment">/* RV_SYS */</span>
    MBUS_PMU_CE<span class="token punctuation">,</span>            <span class="token comment">/* CE */</span>
    MBUS_PMU_DE<span class="token punctuation">,</span>            <span class="token comment">/* DE */</span>
    MBUS_PMU_G2D<span class="token punctuation">,</span>           <span class="token comment">/* G2D */</span>
    MBUS_PMU_TVD<span class="token punctuation">,</span>           <span class="token comment">/* TVD */</span>
    MBUS_PMU_CSI<span class="token punctuation">,</span>           <span class="token comment">/* CSI */</span>
    MBUS_PMU_DSP_SYS<span class="token punctuation">,</span>       <span class="token comment">/* DSP_SYS */</span>
    MBUS_PMU_DI<span class="token punctuation">,</span>            <span class="token comment">/* DI */</span>
    MBUS_PMU_IOMMU<span class="token punctuation">,</span>         <span class="token comment">/* IOMMU */</span>
    MBUS_PMU_DMA0<span class="token punctuation">,</span>          <span class="token comment">/* DMA0 */</span>
    MBUS_PMU_DMA1<span class="token punctuation">,</span>          <span class="token comment">/* DMA1 */</span>
    MBUS_PMU_MAHB<span class="token punctuation">,</span>          <span class="token comment">/* MAHB */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="返回值枚举" tabindex="-1"><a class="header-anchor" href="#返回值枚举" aria-hidden="true">#</a> 返回值枚举</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
    HAL_MBUS_STATUS_ERROR_PARAMETER <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span>
    HAL_MBUS_STATUS_ERROR_CHANNEL <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>
    HAL_MBUS_STATUS_ERROR <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    HAL_MBUS_STATUS_OK <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token class-name">hal_mbus_status_t</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mbus-总线使能接口" tabindex="-1"><a class="header-anchor" href="#mbus-总线使能接口" aria-hidden="true">#</a> Mbus 总线使能接口</h3><p>使能Mbus总线</p><p>函数原型：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token class-name">hal_mbus_status_t</span> <span class="token function">hal_mbus_pmu_enable</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>参数：</p><ul><li>无</li></ul><p>返回值：</p><ul><li>参考hal_mbus_status_t枚举</li></ul><h3 id="获取带宽接口" tabindex="-1"><a class="header-anchor" href="#获取带宽接口" aria-hidden="true">#</a> 获取带宽接口</h3><p>获取不同模块在总线上的带宽</p><p>函数原型：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token class-name">hal_mbus_status_t</span> <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span><span class="token keyword">enum</span> <span class="token class-name">mbus_pmu</span> type<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>参数：</p><ul><li>type：模块类型</li><li>value，保存获取的带宽数据</li></ul><p>返回值：</p><ul><li>参考hal_mbus_status_t枚举</li></ul><h2 id="模块使用范例" tabindex="-1"><a class="header-anchor" href="#模块使用范例" aria-hidden="true">#</a> 模块使用范例</h2><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;hal_cmd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sunxi_hal_mbus.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">cmd_mbus</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ms_delay <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> windows_us<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> cpu_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> gpu_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ve_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> disp_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> total_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> di_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> oth_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> csi_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> tvd_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> g2d_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> iommu_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> rv_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> dsp_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> dma0_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> dma1_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> de_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> ce_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> mahb_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>rv_sys_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;============MBUS TEST===============\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">hal_mbus_pmu_enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span>
        cnt <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span>
        ms_delay <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;the bus bandwidth occupancy status is :\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cnt<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_CPU<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cpu_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_GPU<span class="token punctuation">,</span> <span class="token operator">&amp;</span>gpu_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_RV_SYS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rv_sys_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_VE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ve_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DISP<span class="token punctuation">,</span> <span class="token operator">&amp;</span>disp_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_OTH<span class="token punctuation">,</span> <span class="token operator">&amp;</span>oth_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_CE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ce_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DI<span class="token punctuation">,</span> <span class="token operator">&amp;</span>di_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>de_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_CSI<span class="token punctuation">,</span> <span class="token operator">&amp;</span>csi_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_TVD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tvd_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_G2D<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g2d_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_IOMMU<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iommu_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_RV_SYS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rv_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DSP_SYS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dsp_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DMA0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dma0_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DMA1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dma1_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_MAHB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mahb_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_TOTAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>total_value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//mbus calculate bw every window time, total is the max one</span>
        <span class="token function">hal_mbus_pmu_get_window</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>windows_us<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;window(us) maxbw(k) cpu      gpu      ve       disp     di       csi      tvd      g2d      iommu    rv       dsp      dma0     dma1     cd       de       mahb     others  rv_sys\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d\\n&quot;</span><span class="token punctuation">,</span>\\
                windows_us <span class="token punctuation">,</span> total_value<span class="token punctuation">,</span> cpu_value<span class="token punctuation">,</span> gpu_value<span class="token punctuation">,</span> ve_value<span class="token punctuation">,</span> disp_value<span class="token punctuation">,</span>\\
                di_value<span class="token punctuation">,</span> csi_value<span class="token punctuation">,</span> tvd_value<span class="token punctuation">,</span> g2d_value<span class="token punctuation">,</span> iommu_value<span class="token punctuation">,</span>\\
                rv_value<span class="token punctuation">,</span> dsp_value<span class="token punctuation">,</span> dma0_value<span class="token punctuation">,</span> dma1_value<span class="token punctuation">,</span> ce_value<span class="token punctuation">,</span>\\
                de_value<span class="token punctuation">,</span> mahb_value<span class="token punctuation">,</span> oth_value<span class="token punctuation">,</span>rv_sys_value<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">&amp;&amp;</span> ms_delay<span class="token punctuation">)</span>
            <span class="token function">mdelay</span><span class="token punctuation">(</span>ms_delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">FINSH_FUNCTION_EXPORT_CMD</span><span class="token punctuation">(</span>cmd_mbus<span class="token punctuation">,</span> mbus_test<span class="token punctuation">,</span> Mbus hal APIs tests<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">cmd_mbus_enable</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">hal_mbus_pmu_enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">FINSH_FUNCTION_EXPORT_CMD</span><span class="token punctuation">(</span>cmd_mbus_enable<span class="token punctuation">,</span> mbus_enable<span class="token punctuation">,</span> Mbus hal enable APIs tests<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">cmd_mbus_value</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">int</span> cnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> ms_delay <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> windows_us<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> cpu_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> gpu_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ve_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> disp_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> total_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> di_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> oth_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> csi_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> tvd_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> g2d_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> iommu_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> rv_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> dsp_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> dma0_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> dma1_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> de_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> ce_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> mahb_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>rv_sys_value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span>
        cnt <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span>
        ms_delay <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;the bus bandwidth occupancy status is :\\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cnt<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_CPU<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cpu_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_GPU<span class="token punctuation">,</span> <span class="token operator">&amp;</span>gpu_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_VE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ve_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DISP<span class="token punctuation">,</span> <span class="token operator">&amp;</span>disp_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_OTH<span class="token punctuation">,</span> <span class="token operator">&amp;</span>oth_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_CE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ce_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DI<span class="token punctuation">,</span> <span class="token operator">&amp;</span>di_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>de_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_CSI<span class="token punctuation">,</span> <span class="token operator">&amp;</span>csi_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_TVD<span class="token punctuation">,</span> <span class="token operator">&amp;</span>tvd_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_G2D<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g2d_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_IOMMU<span class="token punctuation">,</span> <span class="token operator">&amp;</span>iommu_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_RV_SYS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>rv_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DSP_SYS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dsp_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DMA0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dma0_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_DMA1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dma1_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_MAHB<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mahb_value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">hal_mbus_pmu_get_value</span><span class="token punctuation">(</span>MBUS_PMU_TOTAL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>total_value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//mbus calculate bw every window time, total is the max one</span>
        <span class="token function">hal_mbus_pmu_get_window</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>windows_us<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;window(us) maxbw(k) cpu      gpu      ve       disp     di       csi      tvd      g2d      iommu    rv       dsp      dma0     dma1     cd       de       mahb     others \\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%-10d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d %-8d   0x%08x  %-8d %-8d %-8d %-8d %-8d %-8d %-8d \\n&quot;</span><span class="token punctuation">,</span>\\
                windows_us <span class="token punctuation">,</span> total_value<span class="token punctuation">,</span> cpu_value<span class="token punctuation">,</span> gpu_value<span class="token punctuation">,</span> ve_value<span class="token punctuation">,</span> disp_value<span class="token punctuation">,</span>\\
                di_value<span class="token punctuation">,</span> csi_value<span class="token punctuation">,</span> tvd_value<span class="token punctuation">,</span> g2d_value<span class="token punctuation">,</span> iommu_value<span class="token punctuation">,</span>\\
                rv_value<span class="token punctuation">,</span> dsp_value<span class="token punctuation">,</span> dma0_value<span class="token punctuation">,</span> dma1_value<span class="token punctuation">,</span> ce_value<span class="token punctuation">,</span>\\
                de_value<span class="token punctuation">,</span> mahb_value<span class="token punctuation">,</span> oth_value<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">&amp;&amp;</span> ms_delay<span class="token punctuation">)</span>
            <span class="token function">mdelay</span><span class="token punctuation">(</span>ms_delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">FINSH_FUNCTION_EXPORT_CMD</span><span class="token punctuation">(</span>cmd_mbus_value<span class="token punctuation">,</span> mbus_test_value<span class="token punctuation">,</span> Mbus hal value APIs tests<span class="token punctuation">)</span><span class="token punctuation">;</span>
\`\`</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,32),o=[e];function c(u,l){return s(),a("div",null,o)}const k=n(t,[["render",c],["__file","chapter17.html.vue"]]);export{k as default};

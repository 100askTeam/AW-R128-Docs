import{_ as o,r,o as p,c as i,a as e,b as n,d as a,e as t}from"./app-e85d5a28.js";const c={},l=t('<h1 id="使用-vscode-调试" tabindex="-1"><a class="header-anchor" href="#使用-vscode-调试" aria-hidden="true">#</a> 使用 VSCode 调试</h1><h2 id="调试-xuantie-c906-核心" tabindex="-1"><a class="header-anchor" href="#调试-xuantie-c906-核心" aria-hidden="true">#</a> 调试 XuanTie C906 核心</h2><h3 id="准备工具" tabindex="-1"><a class="header-anchor" href="#准备工具" aria-hidden="true">#</a> 准备工具</h3>',3),d=e("li",null,"T-Head DebugServer（CSkyDebugServer） - 搭建调试服务器",-1),u={href:"https://xuantie.t-head.cn/community/download?id=4202772147627692032",target:"_blank",rel:"noopener noreferrer"},v={href:"https://xuantie.t-head.cn/community/download?id=4170589434888130560",target:"_blank",rel:"noopener noreferrer"},m={href:"https://xuantie.t-head.cn/community/download?id=689487495854817280",target:"_blank",rel:"noopener noreferrer"},k=e("li",null,"VSCode - 开发&调试",-1),g={href:"https://code.visualstudio.com/",target:"_blank",rel:"noopener noreferrer"},h=t(`<h3 id="配置-sdk-启用调试功能" tabindex="-1"><a class="header-anchor" href="#配置-sdk-启用调试功能" aria-hidden="true">#</a> 配置 SDK 启用调试功能</h3><p>在对应的C906的 <code>main.c</code> 函数最后面加上下列代码，配置 GPIO MUX 为 JTAG</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token function">writel</span><span class="token punctuation">(</span><span class="token number">0x00f66660</span><span class="token punctuation">,</span> <span class="token number">0x4004a40c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part4/chapter2/image1.jpg" alt="image1"></p><p>参考手册：</p><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part4/chapter2/image2.jpg" alt="image2"></p><p>然后编译下载。</p><h3 id="安装驱动" tabindex="-1"><a class="header-anchor" href="#安装驱动" aria-hidden="true">#</a> 安装驱动</h3><p>连接上CKLink，在设备管理器新增的USB设备上-&gt;右键-&gt;更新驱动程序-&gt;浏览我的电脑以查找驱动程序-&gt;浏览对应的驱动然后包括子文件夹-&gt;然后下一步即可。</p><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part4/chapter2/image3.jpg" alt="image3"></p><h3 id="运行配置cskydebugserver" tabindex="-1"><a class="header-anchor" href="#运行配置cskydebugserver" aria-hidden="true">#</a> 运行配置CSkyDebugServer</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>CSkyDebugServer-&gt;setting-&gt;Target Setting
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part4/chapter2/image4.jpg" alt="image4"></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>SkyDebugServer-&gt;setting-&gt;Target Setting
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part4/chapter2/image5.jpg" alt="image5"></p><h3 id="启动cskydebugserver" tabindex="-1"><a class="header-anchor" href="#启动cskydebugserver" aria-hidden="true">#</a> 启动CSkyDebugServer</h3><p>确保R128正常运行，CKLink 正常连接，点击红色按钮启动调试</p><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part4/chapter2/image6.jpg" alt="image6"></p><p>此时如果电脑本地上有编译环境，可以使用 <code>riscv64-unknown-elf-gdb</code> 进行调试，假设编译获得的文件路径为 <code>/lichee/rtos/build/r128_module_c906/img/rt_system.elf</code>，运行命令如下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>riscv64-unknown-elf-gdb -ex &#39;set arch riscv:rv64&#39; -ex &#39;file ./lichee/rtos/build/r128_module_c906/img/rt_system.elf&#39; -ex &#39;set remotetimeout 20&#39; -ex &#39;target remote 127.0.0.1:3333&#39;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>也可以如下操作</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>riscv64-unknown-elf-gdb ./lichee/rtos/build/r128_module_c906/img/rt_system.elf

控制台界面输入
set remotetimeout 20
target remote :3333
才可以建立连接
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置-vscode" tabindex="-1"><a class="header-anchor" href="#配置-vscode" aria-hidden="true">#</a> 配置 VSCode</h3><p>配置如下 <code>.vscode/launch.json</code> 文件</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token comment">// Use IntelliSense to learn about possible attributes.</span>
    <span class="token comment">// Hover to view descriptions of existing attributes.</span>
    <span class="token comment">// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(gdb) Launch&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cppdbg&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;program&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\${workspaceFolder}/lichee/rtos/build/r128_module_c906/img/rt_system.elf&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 对应板子方案的elf文件</span>
            <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;stopAtEntry&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">&quot;cwd&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\${fileDirname}&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;environment&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;externalConsole&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">&quot;MIMode&quot;</span><span class="token operator">:</span> <span class="token string">&quot;gdb&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;miDebuggerPath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;\${workspaceFolder}/lichee/rtos/tools/riscv64-elf-x86_64-20201104/bin/riscv64-unknown-elf-gdb&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;miDebuggerServerAddress&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:3333&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 端口号，本文电脑的CSkyDebugServer端口3333</span>
            <span class="token property">&quot;setupCommands&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 不能省略否则会报错，报错如下</span>
                <span class="token punctuation">{</span>
                    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Enable pretty-printing for gdb&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;text&quot;</span><span class="token operator">:</span> <span class="token string">&quot;set remotetimeout 20&quot;</span><span class="token punctuation">,</span>
                    <span class="token property">&quot;ignoreFailures&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>省略后的报错：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Remote replied unexpectedly to &#39;vMustReplyEmpty&#39;: PacketSize=1000;QStartNoAckMode+;qThreadExtraInfo+;qXfer:features:read+
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="开始调试" tabindex="-1"><a class="header-anchor" href="#开始调试" aria-hidden="true">#</a> 开始调试</h3><p>点击 VSCode 调试按键，开始调试。</p><p><img src="http://photos.100ask.net/aw-r128-docs/rtos/developer-guide/part4/chapter2/image7.jpg" alt="image7"></p>`,30);function b(q,x){const s=r("ExternalLinkIcon");return p(),i("div",null,[l,e("ul",null,[d,e("li",null,[n("下载地址："),e("a",u,[n("T-Head DebugServer"),a(s)])]),e("li",null,[n("手册："),e("a",v,[n("T-Head Debugger Server User Guide"),a(s)])]),e("li",null,[n("驱动："),e("a",m,[n("cklink_dirvers"),a(s)])]),k,e("li",null,[n("下载地址："),e("a",g,[n("VSCode"),a(s)])])]),h])}const _=o(c,[["render",b],["__file","chapter2.html.vue"]]);export{_ as default};
